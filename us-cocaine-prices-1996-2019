##
##
## Author: Raquel Baeta
## Thesis title: The Role of International Commitments in Combating the Illicit Distribution of Cocaine.
## Data Source: United Nations Office on Drugs and Crime (UNODC).
## Variables: "us retail adjusted average for inflation in US$ dollar", "us retail purity average", "us retail adjusted average for 
## inflation and purity in US$ dollar", "us wholesale average", and "us wholesale adjusted inflation average in US$ Dollar".

## Packages needed for analysis 
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("data.table")

library(readxl)
library(tidyr)
library(dplyr)
library(data.table)

## This is the set Working directory.
setwd("/Users/raquelbaeta/Desktop/working_sessions/datasets")

## [1] Retail prices of cocaine in the United States of America, 1996-2019.

## Load the data set from the United Nations Office on Drugs and Crime (1996-2019).
us_cocaine <- read_excel(path = "~/Desktop/working_sessions/datasets/price_dollar_western_europe.xlsx", sheet = 4, range = "A3:AF7")
head(us_cocaine) # Take a sneak eak at the data set

## Remove the additional columns (the years 1990 to 1995 and 2020). 
us_cocaine[2:7] <- NULL # Remove the years from 1990 to 1995.
us_cocaine[26] <- NULL # Remove the year 2020.
head(us_cocaine) # Give the data s sneak peak.

## Transform the data set so that "us_retail_unwght_avg" is the variable for later manipulation.
us_cocaine <- pivot_longer(us_cocaine, 
                           cols = c("1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", 
                                    "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019"),
                           names_to = "year", values_to = "us_retail_unwght_avg")
head(us_cocaine) # Check 

## Create a variable for the United States for later manipulation.
us_cocaine$country <- "United States" # Add the US as a country variable.
us_cocaine$code <- "USA" # Add the US as a code variable
head(us_cocaine) # Give the data s sneak peak.

## Extract "retail adjusted average for inflation in US$ dollar" observations.
us_retail_infltn_avg <- us_cocaine[25:48, 2:5]
colnames(us_retail_infltn_avg)[2] <- "us_retail_infltn_avg"
head(us_retail_infltn_avg) # Give the data s sneak peak.

## Extract "retail purity average" observations.
us_retail_prty_avg <- us_cocaine[49:72, 2:5]
colnames(us_retail_prty_avg)[2] <- "us_retail_prty_avg"
head(us_retail_prty_avg) # Give the data s sneak peak.

## Extract "retail adjusted average for inflation and purity in US$ dollar" observations.
us_retail_infltn_prty_avg <- us_cocaine[73:96, 2:5]
colnames(us_retail_infltn_prty_avg)[2] <- "us_retail_infltn_prty_avg"
head(us_retail_infltn_prty_avg) # Give the data s sneak peak.

## Merge the variables into one data frame.
us_retail <- data.frame(us_cocaine, us_retail_infltn_avg, us_retail_prty_avg, us_retail_infltn_prty_avg, by = "year", "country",  
                        "code")
colnames(us_retail) # Peak to see if the merge was successful.

## Remove the additional columns created by the merge.
us_retail[1] <- NULL # Remove the "series" columns
us_retail[5] <- NULL # Remove a duplicate of "year"
us_retail[6:8] <- NULL # Remove duplicates of "country", "code", and "year".
us_retail[7:9] <- NULL # Remove duplicates of "country", "code", and "year".
us_retail[8:12] <- NULL # Remove duplicates of "country", "code", and "year".
colnames(us_retail) # Check for duplicates.

## Clean up the work environment before cleaning removing the following variables.
rm(us_cocaine, us_retail_infltn_avg, us_retail_prty_avg, us_retail_infltn_prty_avg)

## [1] Retail prices of cocaine in the United States of America, 1996-2019.

## Load the data set from the United Nations Office on Drugs and Crime (1996-2019)
us_cocaine <- read_excel(path = "~/Desktop/working_sessions/datasets/price_dollar_western_europe.xlsx", sheet = 4, range = "A12:AF14")
head(us_cocaine) # Take a sneak peak at the data.

## Remove the additional columns (the years 1990 to 1995 and 2020).  
us_cocaine[2:7] <- NULL # Remove the years from 1990 to 1995.
us_cocaine[26] <- NULL # Remove the year 2020.
head(us_cocaine) # Check

## Transform the data set so that "us_wholsl" is the variable for later manipulation.
us_cocaine <- pivot_longer(us_cocaine, 
                           cols = c("1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007",   
                                    "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019"),
                             names_to = "year", values_to = "us_wholsl")
head(us_cocaine)

## Create a variable for the United States for later manipulation.
us_cocaine$country <- "United States" # Add the US as a country variable.
us_cocaine$code <- "USA" # Add the US as a code variable
head(us_cocaine) # Give the data s sneak peak.

## Extract "wholesale adjusted inflation average in US$ Dollar" observations.
us_wholsl_infltn_avg <- us_cocaine[25:48, 2:5]
colnames(us_wholsl_infltn_avg)[2] <- "us_wholsl_infltn_avg"
head(us_wholsl_infltn_avg)

## Merge the variables into one data frame.
us_wholesale <- data.frame(us_wholsl_infltn_avg, us_cocaine)
colnames(us_wholesale) # Check

## Remove additional columns created by the merge.
us_wholesale[5:6] <- NULL #  Remove additional "year".
us_wholesale[6:7] <- NULL # Remove additional "country", "code".
head(us_wholesale) # Check

## Clean up the work environment before cleaning removing the following variables.
rm(us_wholsl_infltn_avg, us_cocaine)

## Merge the "us_retail" and "us_wholesale" data frames for United State's retail annual averages and wholesale annual averages.  
# us_cocaine <- merge(us_retail, us_wholesale, by = "year")
# head(us_cocaine) # Take a sneak peak at the data.

## Export the data frames to a CSV file named "us_retail.csv", and "us_wholesale.csv".
fwrite(us_retail, "us_retail.csv")
fwrite(us_wholesale, "us_wholesale.csv")
