# Start

# Thesis title: The Role of International Commitments in Combating the Illicit Distribution of Cocaine.
# Author: Raquel Baeta

# Data Source: United Nations (UN), United Nations Office on Drugs and Crime (UNODC), World Governance Indicators (WGI) and World Bank 
# (WB).

# Step 7.1: Merge "cocaine," "seizures," and "public_order" by "country" and "year"
prices_kg <- full_join(prices, 
                       public_order, 
                       by = c("country", "year"))

# Convert "year" in "prices_kg" to numeric.
prices_kg$year <- as.numeric(prices_kg$year)

# Step 7.2: Merge "prices_kg" and "seizures"
prices_kg <- full_join(prices_kg, 
                       seizures, 
                       by = c("country", "year"))

# Clean the environment 
rm(prices, public_order, seizures)

# Add country codes using countrycode function
prices_kg$code <- countrycode(prices_kg$country, 
                              origin = "country.name", 
                              destination = "iso3c")

# Step 7.3: Merge "prices_kg" and "untreaties" by "country", "region", "code"
cocaine <- full_join(prices_kg, 
                     untreaties, 
                     by = c("country", "region", "code"))

# Clean environment
rm(prices_kg, untreaties)

# Step 7.4: Join wb and wgi as  "country", "code", and "year".
wb_wgi <- full_join(wb, 
                    wgi, 
                    by = c("country", "code", "year"))

# Clean environment
rm(wb, wgi)

# Step 7.5: Merge "wb_wgi" and "cocaine" by "country", "code", and "year".
data <- full_join(wb_wgi, 
                  cocaine, 
                  by = c("country", "code", "year"))

# Reorder columns for consistent order
desired_column_order <- c("region", "subregion", "code", "country", "year", "un1961", "un1971", "un1988", "drug", "wholesale",
                          "retail", "seizure", "gni_cap", "gni_ppp", "gnicap_ppp", "gdp_growth", "gdp_dollar", "gdpcap_dollar", 
                          "exports_gdp", "exports_growth", "exports_dollar", "imports_gdp", "imports_growth", "imports_dollar", 
                          "military_gdp", "military_govexp", "military_dollar", "annual_public_order", "cc_est", "cc_no_src", 
                          "cc_per_rnk", "cc_per_rnk_upper", "cc_per_rnk_lower", "cc_std_err", "ge_est", "ge_no_src", "ge_per_rnk", 
                          "ge_per_rnk_lower", "ge_per_rnk_upper", "ge_std_err", "pv_est", "pv_no_src", "pv_per_rnk", "pv_per_rnk_lower", 
                          "pv_per_rnk_upper", "pv_std_err", "rq_est", "rq_no_src", "rq_per_rnk", "rq_per_rnk_lower", "rq_per_rnk_upper", 
                          "rq_std_err", "rl_est", "rl_no_src", "rl_per_rnk", "rl_per_rnk_lower", "rl_per_rnk_upper", "rl_std_err", 
                          "va_est", "va_no_src", "va_per_rnk", "va_per_rnk_lower", "va_per_rnk_upper", "va_std_err")

# Reorder the columns based on the desired order
data_reordered <- data %>%
  select(all_of(desired_column_order))

# Convert seizure values from kilograms to grams
data_reordered$seizure <- data_reordered$seizure * 1000

# Export the final merged dataset to a CSV file named "data.csv"
fwrite(data_reordered, "data.csv")

# Clean environment
rm(wb_wgi, cocaine, data)

# Step 7.6: Merge the annual averages

# Convert "year" in "prices_kg" to numeric.
prices_avg$year <- as.numeric(prices_avg$year)

# Merge using full_join()
prices_wgi_avg <- full_join(prices_avg,
                            wgi_avg, 
                            by = "year")

# Export the final merged data set to a CSV file named "data.csv"
fwrite(prices_wgi_avg, "prices_wgi_avg.csv")

# Clean up: Remove original data frames
rm(prices_avg, wgi_avg)

# End
